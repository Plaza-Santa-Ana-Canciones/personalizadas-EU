<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canciones Personalizadas - Plaza Santa Ana</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600&family=Oswald:wght@400;500;700&family=Pacifico&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <!-- Confetti Effect -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        santa: {
                            pink: '#E91E63',   // Rosa Mexicano
                            cyan: '#00BCD4',   // Cian/Turquesa
                            yellow: '#FFC107', // Amarillo Cempas√∫chil
                            dark: '#212121',
                            light: '#FAFAFA',
                        }
                    },
                    fontFamily: {
                        sans: ['Fredoka', 'sans-serif'],
                        heading: ['Oswald', 'sans-serif'],
                        hand: ['Pacifico', 'cursive'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #FAFAFA;
            background-image: radial-gradient(#E91E63 0.5px, transparent 0.5px), radial-gradient(#00BCD4 0.5px, #FAFAFA 0.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: #212121;
        }
        
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        .flower-border {
            border: 2px solid #E91E63;
            border-radius: 1rem;
            position: relative;
        }

        .input-field {
            background: #ffffff;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
            color: #212121;
        }
        .input-field:focus {
            border-color: #E91E63;
            outline: none;
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        }

        /* Efecto de Iluminaci√≥n en Tarjetas */
        .plan-card {
            transition: all 0.3s ease;
        }
        .plan-card:hover, .plan-card.active {
            border-color: #E91E63;
            box-shadow: 0 0 25px rgba(233, 30, 99, 0.3);
            transform: translateY(-5px);
        }

        /* Panel de Edici√≥n */
        #editor-panel {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        #editor-panel.open {
            transform: translateX(0);
        }

        .admin-only { display: none; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #E91E63; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #d81b60; }

        /* Estilos para Reproductores */
        audio, video {
            border-radius: 0.5rem;
            outline: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans">

    <!-- Bot√≥n Flotante de Edici√≥n (SOLO ADMIN) -->
    <button id="admin-trigger" onclick="toggleEditor()" class="admin-only fixed bottom-4 right-4 z-[90] bg-gray-800 text-white p-3 rounded-full shadow-lg hover:bg-gray-700 transition-all border border-santa-pink" title="Editar Contenido">
        <i class="fas fa-cog text-xl"></i>
    </button>

    <!-- Panel de Edici√≥n Lateral (SOLO ADMIN) -->
    <div id="editor-panel" class="admin-only fixed top-0 right-0 h-full w-80 bg-white border-l border-gray-200 z-[100] shadow-2xl p-6 overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-santa-pink font-heading font-bold uppercase text-xl">Administraci√≥n</h3>
            <button onclick="toggleEditor()" class="text-gray-400 hover:text-red-500"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="space-y-4 text-xs">
            <div class="bg-blue-50 p-2 rounded border border-blue-200 mb-4">
                <p class="text-blue-600">üõ†Ô∏è <strong>Modo Editor</strong><br>Ajusta precios y textos en tiempo real.</p>
            </div>

            <div>
                <label class="block text-gray-500 mb-1 font-bold">Texto Promoci√≥n (Header)</label>
                <input type="text" id="edit-promo" class="input-field w-full p-2 rounded" oninput="updateContent()">
            </div>
            
            <div class="border-t border-gray-200 pt-4 mt-4">
                <h4 class="text-santa-dark font-bold mb-2">Precios (USD)</h4>
                <div class="grid grid-cols-1 gap-2">
                    <div>
                        <label class="block text-gray-500">üéµ B√°sico (Audio)</label>
                        <input type="number" id="edit-price-basic" class="input-field w-full p-2 rounded" oninput="updateContent()">
                    </div>
                    <div>
                        <label class="block text-gray-500">üì± Premium (Video Simple)</label>
                        <input type="number" id="edit-price-premium" class="input-field w-full p-2 rounded" oninput="updateContent()">
                    </div>
                    <div>
                        <label class="block text-gray-500">‚ú® Animado (Reel + Animaci√≥n)</label>
                        <input type="number" id="edit-price-animated" class="input-field w-full p-2 rounded" oninput="updateContent()">
                    </div>
                     <div>
                        <label class="block text-gray-500">‚ö° Costo Extra Urgente</label>
                        <input type="number" id="edit-price-rush" class="input-field w-full p-2 rounded" oninput="updateContent()">
                    </div>
                </div>
            </div>

            <div class="bg-santa-yellow/20 p-3 rounded mt-6 border border-santa-yellow">
                <p class="text-[10px] text-gray-600 mb-2">
                    Para guardar cambios permanentes, copia este c√≥digo y reemplaza la secci√≥n "CONFIGURACI√ìN EDITABLE" en el archivo HTML.
                </p>
                <button onclick="copyConfig()" class="w-full bg-santa-yellow text-black font-bold py-2 rounded text-[10px] uppercase hover:bg-yellow-400 transition-colors shadow">
                    Copiar Configuraci√≥n
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <nav class="fixed top-0 w-full z-50 bg-white/95 backdrop-blur-md border-b border-gray-100 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 py-2 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <!-- Logo Imagen -->
                <div class="w-12 h-12 md:w-14 md:h-14 rounded-full overflow-hidden border-2 border-santa-pink shadow-md bg-white">
                    <img src="Plaza Santa Ana.jpg" alt="Logo Plaza Santa Ana" class="w-full h-full object-cover">
                </div>
                <div>
                    <h1 class="text-xl md:text-2xl font-heading font-bold text-black leading-none uppercase tracking-wide">
                        Plaza <span class="text-santa-pink">Santa Ana</span>
                    </h1>
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest hidden md:block">Canciones Personalizadas</p>
                </div>
            </div>
            <div id="affiliate-badge" class="hidden text-[10px] bg-santa-cyan/10 text-santa-cyan border border-santa-cyan rounded-full px-3 py-1 font-bold">
                Asesor: <span id="affiliate-name"></span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="pt-32 pb-12 px-4 text-center max-w-4xl mx-auto relative overflow-hidden">
        
        <!-- Elementos decorativos de fondo -->
        <div class="absolute top-10 left-10 text-santa-pink opacity-10 text-6xl animate-float"><i class="fas fa-spa"></i></div>
        <div class="absolute top-20 right-10 text-santa-cyan opacity-10 text-8xl"><i class="fas fa-sun"></i></div>

        <h2 class="text-5xl md:text-7xl font-hand text-santa-pink mb-2 rotate-2 inline-block drop-shadow-sm">
            ¬°Dilo con m√∫sica!
        </h2>
        <h3 class="text-2xl md:text-4xl font-heading font-bold text-santa-dark uppercase mb-6 mt-2">
            Tu Historia, <span class="text-santa-cyan">Tu Canci√≥n.</span>
        </h3>
        
        <p class="text-gray-600 max-w-2xl mx-auto mb-8 text-lg">
            Convertimos tus sentimientos en una canci√≥n √∫nica. El regalo perfecto para cumplea√±os, aniversarios o simplemente para decir "Gracias".
        </p>

        <!-- Promoci√≥n Editable -->
        <div class="inline-block bg-santa-yellow text-black shadow-lg rounded-full px-6 py-2 transform -rotate-1 hover:rotate-0 transition-transform cursor-default">
            <p class="text-sm font-bold uppercase tracking-wider">
                <i class="fas fa-heart text-red-600 mr-2"></i> <span id="display-promo">Precios promoci√≥n en febrero</span>
            </p>
        </div>
    </header>

    <!-- Pricing Plans Section -->
    <main class="max-w-7xl mx-auto px-4 pb-24 grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
        
        <!-- Plan B√°sico -->
        <div class="plan-card bg-white rounded-3xl p-6 relative group card-shadow border-t-4 border-gray-300 h-fit mb-4 md:mb-0">
            <div class="text-center mb-4">
                <div class="w-14 h-14 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-xl text-gray-600">
                    <i class="fas fa-music"></i>
                </div>
                <h3 class="text-2xl font-heading font-bold text-gray-800 uppercase">B√°sico</h3>
                <p class="text-xs text-gray-500">Solo Audio</p>
            </div>
            
            <div class="text-center my-4">
                <span class="text-4xl font-bold text-santa-dark">$<span id="display-price-basic">49</span></span>
                <span class="text-sm text-gray-500 uppercase">USD</span>
            </div>
            
            <!-- Audio Player -->
            <div class="mb-6 bg-gray-50 p-2 rounded-lg border border-gray-100">
                <p class="text-[10px] text-gray-400 mb-1 text-center uppercase tracking-wider">Escuchar Ejemplo</p>
                <audio controls class="w-full h-8" onplay="stopOtherMedia(this)">
                    <source src="Basico.mp3" type="audio/mpeg">
                    Tu navegador no soporta el elemento de audio.
                </audio>
            </div>
            
            <ul class="space-y-3 text-sm text-gray-600 mb-8">
                <li class="flex items-start gap-3"><i class="fas fa-check-circle text-santa-pink mt-1"></i> Canci√≥n personalizada</li>
                <li class="flex items-start gap-3"><i class="fas fa-check-circle text-santa-pink mt-1"></i> Formato Audio MP3</li>
                <li class="flex items-start gap-3"><i class="fas fa-clock text-gray-400 mt-1"></i> Duraci√≥n: 1:30 - 2:30 min</li>
            </ul>

            <button onclick="selectPlan('B√°sico')" class="w-full py-3 rounded-xl border-2 border-gray-200 text-gray-600 font-bold uppercase hover:border-santa-dark hover:text-santa-dark transition-colors">
                Elegir B√°sico
            </button>
        </div>

        <!-- Plan Animado (M√ÅS POPULAR) -->
        <div class="plan-card bg-white rounded-3xl p-6 md:p-8 relative z-10 card-shadow border-2 border-santa-cyan transform md:scale-105 order-first md:order-none">
            <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-santa-cyan text-white font-bold px-4 py-1 rounded-full text-xs uppercase tracking-widest shadow-md whitespace-nowrap">
                ‚òÖ M√°s Popular ‚òÖ
            </div>
            
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-cyan-50 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl text-santa-cyan animate-pulse-slow">
                    <i class="fas fa-magic"></i>
                </div>
                <h3 class="text-3xl font-heading font-bold text-santa-dark uppercase">Animado</h3>
                <p class="text-xs text-santa-cyan font-bold">Video + Animaci√≥n Bucle</p>
            </div>
            
            <div class="text-center my-6 border-y border-dashed border-santa-cyan/30 py-4">
                <span class="text-5xl font-bold text-santa-dark">$<span id="display-price-animated">99</span></span>
                <span class="text-sm text-gray-500 uppercase">USD</span>
            </div>

            <!-- Video Player -->
            <div class="mb-6 bg-cyan-50 p-2 rounded-lg border border-cyan-100">
                <p class="text-[10px] text-santa-cyan mb-1 text-center uppercase tracking-wider font-bold">Ver Ejemplo Animado</p>
                <video controls class="w-full rounded bg-black max-h-40 object-cover" onplay="stopOtherMedia(this)">
                    <source src="Animado.mov" type="video/quicktime">
                    <source src="Animado.mp4" type="video/mp4"> <!-- Fallback recomenado -->
                    Tu navegador no soporta video.
                </video>
            </div>
            
            <ul class="space-y-3 text-sm text-gray-600 mb-8">
                <li class="flex items-start gap-3"><i class="fas fa-check-circle text-santa-cyan mt-1"></i> <strong>Todo lo del plan B√°sico</strong></li>
                <li class="flex items-start gap-3 bg-cyan-50 p-2 rounded-lg border border-cyan-100">
                    <i class="fas fa-film text-santa-cyan mt-1"></i> 
                    <span class="text-xs">
                        <strong>Animaci√≥n de 6 seg (Bucle)</strong> integrada.<br>
                        <span class="text-[10px] text-gray-500 italic block mt-1 leading-tight">
                            *La animaci√≥n se repite en bucle si la imagen y secuencia lo permiten; de lo contrario se aplica una sola vez.
                        </span>
                    </span>
                </li>
                <li class="flex items-start gap-3"><i class="fas fa-image text-santa-cyan mt-1"></i> 
                    <span class="text-xs">Usamos tu foto o generamos una imagen acorde a la historia.</span>
                </li>
            </ul>

            <button onclick="selectPlan('Animado')" class="w-full bg-santa-cyan text-white font-bold py-4 rounded-xl uppercase tracking-widest hover:bg-cyan-600 transition-all shadow-lg hover:shadow-cyan-500/30">
                Elegir Animado
            </button>
        </div>

        <!-- Plan Premium -->
        <div class="plan-card bg-white rounded-3xl p-6 relative group card-shadow border-t-4 border-santa-pink h-fit mb-4 md:mb-0">
            <div class="text-center mb-4">
                <div class="w-14 h-14 bg-pink-50 rounded-full flex items-center justify-center mx-auto mb-4 text-xl text-santa-pink">
                    <i class="fas fa-video"></i>
                </div>
                <h3 class="text-2xl font-heading font-bold text-gray-800 uppercase">Premium</h3>
                <p class="text-xs text-gray-500">Audio + Video Reel</p>
            </div>

            <div class="text-center my-4">
                <span class="text-4xl font-bold text-santa-dark">$<span id="display-price-premium">79</span></span>
                <span class="text-sm text-gray-500 uppercase">USD</span>
            </div>

            <!-- Video Player -->
            <div class="mb-6 bg-pink-50 p-2 rounded-lg border border-pink-100">
                <p class="text-[10px] text-santa-pink mb-1 text-center uppercase tracking-wider font-bold">Ver Ejemplo Premium</p>
                <video controls class="w-full rounded bg-black max-h-40 object-cover" onplay="stopOtherMedia(this)">
                    <source src="Premium.mov" type="video/quicktime">
                    <source src="Premium.mp4" type="video/mp4"> <!-- Fallback recomenado -->
                    Tu navegador no soporta video.
                </video>
            </div>

            <ul class="space-y-4 text-sm text-gray-600 mb-8">
                <li class="flex items-start gap-3"><i class="fas fa-check-circle text-santa-pink mt-1"></i> <strong>Todo lo del plan B√°sico</strong></li>
                <li class="flex items-start gap-3 bg-pink-50 p-2 rounded-lg">
                    <i class="fas fa-photo-video text-santa-pink mt-1"></i> 
                    <span class="text-xs">Video tipo Reel (Vertical) listo para redes (Imagen Sencilla).</span>
                </li>
            </ul>

            <button onclick="selectPlan('Premium')" class="w-full py-3 rounded-xl border-2 border-gray-200 text-gray-600 font-bold uppercase hover:border-santa-pink hover:text-santa-pink transition-colors">
                Elegir Premium
            </button>
        </div>

    </main>

    <!-- Footer Note -->
    <div class="max-w-4xl mx-auto px-6 text-center pb-12">
        <div class="bg-white shadow-sm border border-gray-200 p-6 rounded-2xl inline-flex flex-col md:flex-row items-center gap-4">
            <div class="text-4xl text-santa-pink animate-bounce">
                <i class="fas fa-map-marker-alt"></i>
            </div>
            <div class="text-left">
                <h4 class="text-santa-dark font-heading font-bold uppercase text-lg">¬øEres de Santa Ana? üá≤üáΩ</h4>
                <p class="text-sm text-gray-600">
                    ¬°Tenemos una promoci√≥n especial para paisanos! <br>
                    <strong>Pagas hasta tener tu canci√≥n lista y entregada.</strong>
                </p>
            </div>
        </div>
        
        <p class="mt-8 text-xs text-gray-400">
            <i class="fas fa-clock mr-1"></i> Entrega est√°ndar: <strong>4 d√≠as h√°biles</strong>. Opci√≥n Express disponible en el formulario.
        </p>
    </div>

    <!-- Modal Formulario -->
    <div id="order-modal" class="fixed inset-0 z-[100] hidden overflow-y-auto">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        
        <!-- Modal Content -->
        <div class="relative min-h-screen md:min-h-0 flex items-end md:items-center justify-center p-0 md:p-4">
            <div class="w-full md:w-[600px] bg-white rounded-t-3xl md:rounded-2xl shadow-2xl transition-transform duration-300 transform translate-y-full md:translate-y-0" id="modal-panel">
                
                <!-- Header Modal -->
                <div class="bg-santa-dark text-white p-6 rounded-t-3xl md:rounded-t-2xl flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-heading font-bold uppercase italic">Personaliza tu Canci√≥n</h3>
                        <p class="text-xs text-gray-400">Est√°s a un paso de regalar algo inolvidable</p>
                    </div>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-white bg-white/10 w-8 h-8 rounded-full flex items-center justify-center"><i class="fas fa-times"></i></button>
                </div>

                <form id="client-form" onsubmit="handleOrder(event)" class="p-6 md:p-8 space-y-6 max-h-[75vh] overflow-y-auto">
                    
                    <!-- Resumen del Plan -->
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-200">
                        <div>
                            <p class="text-[10px] text-gray-500 uppercase font-bold">Paquete Seleccionado</p>
                            <p id="modal-plan-name" class="text-santa-pink font-heading font-bold text-xl">Premium</p>
                        </div>
                        <div class="text-right">
                            <p id="modal-plan-price" class="text-gray-800 font-bold text-xl">$79 USD</p>
                        </div>
                    </div>

                    <!-- Datos del Cliente -->
                    <div class="space-y-4">
                        <h4 class="text-sm font-bold text-gray-800 border-b pb-2">1. Tus Datos</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs text-gray-500 font-bold mb-1">Tu Nombre</label>
                                <input type="text" id="client-name" required class="input-field w-full rounded p-3 text-sm" placeholder="Ej. Juan P√©rez">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 font-bold mb-1">Ciudad / Pa√≠s</label>
                                <input type="text" id="client-location" required class="input-field w-full rounded p-3 text-sm" placeholder="Ej. Los √Ångeles, CA">
                            </div>
                        </div>
                        
                        <label class="flex items-center gap-2 cursor-pointer bg-santa-cyan/5 p-3 rounded border border-santa-cyan/20">
                            <input type="checkbox" id="check-santa-ana" class="w-5 h-5 text-santa-cyan rounded focus:ring-santa-cyan">
                            <span class="text-sm text-gray-700 font-bold">üôã‚Äç‚ôÇÔ∏è ¬°Soy de Santa Ana! (Pago contra entrega)</span>
                        </label>
                    </div>

                    <!-- Datos de la Canci√≥n -->
                    <div class="space-y-4">
                        <h4 class="text-sm font-bold text-gray-800 border-b pb-2">2. Detalles de la Canci√≥n</h4>
                        
                        <div>
                            <label class="block text-xs text-gray-500 font-bold mb-1">Nombre de la persona especial</label>
                            <input type="text" id="song-recipient" required class="input-field w-full rounded p-3 text-sm" placeholder="¬øA qui√©n le dedicamos la canci√≥n?">
                        </div>

                        <div>
                            <label class="block text-xs text-gray-500 font-bold mb-1">Ocasi√≥n</label>
                            <select id="song-occasion" class="input-field w-full rounded p-3 text-sm">
                                <option value="Cumplea√±os">üéÇ Cumplea√±os</option>
                                <option value="Aniversario/Pareja">‚ù§Ô∏è Amor / Aniversario</option>
                                <option value="D√≠a de la Madre/Padre">üë®‚Äçüë©‚Äçüëß Mam√° / Pap√°</option>
                                <option value="Agradecimiento">üôè Agradecimiento</option>
                                <option value="Perd√≥n">ü•∫ Pedir Perd√≥n</option>
                                <option value="Otro">‚ú® Otra raz√≥n</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-xs text-gray-500 font-bold mb-1">¬øQu√© te gustar√≠a decirle? (Historia, an√©cdotas, mensaje)</label>
                            <textarea id="song-details" required class="input-field w-full rounded p-3 text-sm h-24 resize-none" placeholder="Cu√©ntanos un poco sobre la persona. ¬øEs alegre? ¬øAlguna frase que siempre diga? Nosotros lo convertimos en letra."></textarea>
                            <p class="text-[10px] text-gray-400 mt-1 italic">*Si prefieres, al abrir WhatsApp puedes enviarnos un audio contando la historia.</p>
                        </div>
                    </div>

                    <!-- OPCIONES DE IMAGEN (SOLO PARA PLANES CON VIDEO) -->
                    <div id="video-options-container" class="hidden space-y-4 bg-gray-50 p-3 rounded border border-gray-200">
                        <h4 class="text-xs font-bold text-santa-cyan border-b border-gray-200 pb-1 uppercase">üì∏ Opci√≥n de Imagen para el Video</h4>
                        <div class="space-y-2">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="image-pref" value="Enviar Foto" class="text-santa-cyan focus:ring-santa-cyan" checked>
                                <span class="text-sm text-gray-700">Enviar√© una foto m√≠a por WhatsApp</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="image-pref" value="Generar Imagen" class="text-santa-cyan focus:ring-santa-cyan">
                                <span class="text-sm text-gray-700">Prefiero que generen una imagen (Estilo de la canci√≥n)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Opciones Extra -->
                    <div class="space-y-4 pt-2">
                        <label class="flex items-center gap-2 cursor-pointer p-3 rounded border border-gray-200 hover:bg-gray-50">
                            <input type="checkbox" id="check-rush" class="w-4 h-4 text-red-500 rounded focus:ring-red-500" onchange="updateTotal()">
                            <span class="text-sm text-gray-600">üöÄ <strong>Pedido Urgente</strong> (Entrega R√°pida) <span class="text-red-500 text-xs ml-1 font-bold">+ $<span id="display-rush-fee">20</span> USD</span></span>
                        </label>
                    </div>

                    <!-- Bot√≥n Final -->
                    <div class="pt-2 sticky bottom-0 bg-white border-t border-gray-100">
                        <button type="submit" id="submit-btn" class="w-full bg-[#25D366] text-white font-bold py-4 rounded-xl uppercase tracking-widest hover:bg-[#20bd5a] transition-colors flex justify-center items-center gap-2 shadow-lg shadow-green-500/20">
                            <i class="fab fa-whatsapp text-2xl"></i>
                            <span>Pedir por WhatsApp</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Success Overlay -->
    <div id="success-overlay" class="fixed inset-0 z-[110] hidden bg-white/95 flex flex-col items-center justify-center p-4 text-center">
        <div class="bg-santa-pink p-6 rounded-full mb-6 animate-bounce shadow-lg text-white">
            <i class="fas fa-paper-plane text-4xl"></i>
        </div>
        <h2 class="text-4xl font-hand text-santa-dark mb-2">¬°Mensaje Listo!</h2>
        <p class="text-gray-500 max-w-md mb-8">
            Gracias <span id="success-name" class="text-santa-pink font-bold"></span>.
            <br>
            Abriendo WhatsApp para enviar los detalles de tu canci√≥n...
        </p>
        <button onclick="location.reload()" class="text-santa-cyan hover:underline text-sm font-bold">Volver al inicio</button>
    </div>

    <footer class="bg-santa-dark py-10 text-white mt-auto border-t-4 border-santa-pink">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <!-- Logo Footer -->
            <div class="w-16 h-16 rounded-full overflow-hidden border-2 border-santa-pink shadow-md bg-white mx-auto mb-4">
                <img src="Plaza Santa Ana.jpg" alt="Logo Plaza Santa Ana" class="w-full h-full object-cover">
            </div>
            <p class="text-xl font-heading font-bold uppercase tracking-widest">Plaza Santa Ana</p>
            <p class="text-gray-400 text-xs uppercase tracking-widest mt-1">Canciones Personalizadas ¬∑ M√©xico ¬∑ USA</p>
            <div class="mt-6 flex justify-center gap-4 text-gray-400">
                <a href="#" class="hover:text-white"><i class="fab fa-facebook fa-lg"></i></a>
                <a href="#" class="hover:text-white"><i class="fab fa-instagram fa-lg"></i></a>
                <a href="#" class="hover:text-white"><i class="fab fa-tiktok fa-lg"></i></a>
            </div>
        </div>
    </footer>

    <script>
        // ==========================================
        //  1. CONFIGURACI√ìN EDITABLE
        // ==========================================
        let config = {
            promoText: "Precios promoci√≥n en febrero ‚ù§Ô∏è",
            priceBasic: 49,
            pricePremium: 79,
            priceAnimated: 99,
            priceRush: 20, // Costo extra por urgencia
            whatsappNumber: "527751193381"
        };
        // ==========================================

        // ==========================================
        //  2. L√ìGICA DE FIREBASE Y NEGOCIO
        // ==========================================
        
        let db;
        let auth;
        
        // CONFIGURACI√ìN FIREBASE
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "API_KEY_PLACEHOLDER",
            authDomain: "plaza-santa-ana.firebaseapp.com",
            projectId: "plaza-santa-ana",
            storageBucket: "plaza-santa-ana.appspot.com",
        };

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'santa-ana-songs';

        // Inicializaci√≥n segura de Firebase
        try {
            if (typeof firebase !== 'undefined' && !firebase.apps.length && firebaseConfig.apiKey !== "API_KEY_PLACEHOLDER") {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                
                if (typeof __initial_auth_token !== 'undefined') {
                    auth.signInWithCustomToken(__initial_auth_token);
                } else {
                    auth.signInAnonymously().catch(e => console.error("Auth Error", e));
                }
            }
        } catch (e) { console.warn("Modo sin base de datos (solo WhatsApp)", e); }

        let selectedPlan = { name: '', price: 0 };
        let affiliateCode = null;

        // Inicializaci√≥n al Cargar
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            // 1. Verificar Afiliado (?ref=Maria)
            const ref = urlParams.get('ref');
            if (ref) {
                affiliateCode = ref;
                document.getElementById('affiliate-badge').classList.remove('hidden');
                document.getElementById('affiliate-badge').classList.add('inline-block');
                document.getElementById('affiliate-name').textContent = ref;
            }

            // 2. Verificar Modo Admin (?admin=true)
            const isAdmin = urlParams.get('admin') === 'true';
            if (isAdmin) {
                const adminElements = document.querySelectorAll('.admin-only');
                adminElements.forEach(el => el.style.display = 'block');
            }

            loadConfig();
        });

        // Funciones Multimedia
        function stopOtherMedia(currentMedia) {
            const allMedia = document.querySelectorAll('audio, video');
            allMedia.forEach(media => {
                if (media !== currentMedia) {
                    media.pause();
                }
            });
        }

        // Funciones del Editor
        function loadConfig() {
            // Display
            document.getElementById('display-promo').textContent = config.promoText;
            document.getElementById('display-price-basic').textContent = config.priceBasic;
            document.getElementById('display-price-premium').textContent = config.pricePremium;
            document.getElementById('display-price-animated').textContent = config.priceAnimated;
            document.getElementById('display-rush-fee').textContent = config.priceRush;

            // Inputs Editor
            document.getElementById('edit-promo').value = config.promoText;
            document.getElementById('edit-price-basic').value = config.priceBasic;
            document.getElementById('edit-price-premium').value = config.pricePremium;
            document.getElementById('edit-price-animated').value = config.priceAnimated;
            document.getElementById('edit-price-rush').value = config.priceRush;
        }

        function updateContent() {
            config.promoText = document.getElementById('edit-promo').value;
            config.priceBasic = document.getElementById('edit-price-basic').value;
            config.pricePremium = document.getElementById('edit-price-premium').value;
            config.priceAnimated = document.getElementById('edit-price-animated').value;
            config.priceRush = document.getElementById('edit-price-rush').value;
            loadConfig();
            
            // Si el modal est√° abierto, actualizar precio total
            if (!document.getElementById('order-modal').classList.contains('hidden')) {
                updateTotal();
            }
        }

        function toggleEditor() {
            document.getElementById('editor-panel').classList.toggle('open');
        }

        function copyConfig() {
            const code = `
        let config = {
            promoText: "${config.promoText}",
            priceBasic: ${config.priceBasic},
            pricePremium: ${config.pricePremium},
            priceAnimated: ${config.priceAnimated},
            priceRush: ${config.priceRush},
            whatsappNumber: "${config.whatsappNumber}"
        };`;
            
            navigator.clipboard.writeText(code).then(() => {
                alert("¬°Configuraci√≥n copiada! P√©gala en el c√≥digo HTML.");
            });
        }

        // Selecci√≥n de Plan
        function selectPlan(planName) {
            let price = 0;
            
            if (planName === 'B√°sico') price = config.priceBasic;
            else if (planName === 'Premium') price = config.pricePremium;
            else if (planName === 'Animado') price = config.priceAnimated;

            selectedPlan = { name: planName, price: parseInt(price) };
            
            document.getElementById('modal-plan-name').textContent = planName;
            document.getElementById('check-rush').checked = false; // Reset urgente
            
            // Mostrar opciones de imagen solo si es Premium o Animado
            const videoOptions = document.getElementById('video-options-container');
            if (planName === 'Premium' || planName === 'Animado') {
                videoOptions.classList.remove('hidden');
            } else {
                videoOptions.classList.add('hidden');
            }

            updateTotal();
            
            const modal = document.getElementById('order-modal');
            const panel = document.getElementById('modal-panel');
            modal.classList.remove('hidden');
            setTimeout(() => panel.classList.remove('translate-y-full'), 10);
        }

        function updateTotal() {
            let total = parseInt(selectedPlan.price);
            const isRush = document.getElementById('check-rush').checked;
            
            if (isRush) {
                total += parseInt(config.priceRush);
            }
            
            document.getElementById('modal-plan-price').textContent = `$${total} USD`;
        }

        function closeModal() {
            const modal = document.getElementById('order-modal');
            const panel = document.getElementById('modal-panel');
            panel.classList.add('translate-y-full');
            setTimeout(() => modal.classList.add('hidden'), 300);
            
            // Pausar medios si estaban sonando al abrir modal (opcional, pero buena pr√°ctica)
            stopOtherMedia(null); 
        }

        // Procesar Pedido
        async function handleOrder(e) {
            e.preventDefault();
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Preparando...';

            const name = document.getElementById('client-name').value;
            const location = document.getElementById('client-location').value;
            const isSantaAna = document.getElementById('check-santa-ana').checked;
            const recipient = document.getElementById('song-recipient').value;
            const occasion = document.getElementById('song-occasion').value;
            const details = document.getElementById('song-details').value;
            const isRush = document.getElementById('check-rush').checked;
            
            let finalPrice = parseInt(selectedPlan.price);
            if(isRush) finalPrice += parseInt(config.priceRush);

            // Obtener preferencia de imagen si aplica
            let imagePref = '';
            if (selectedPlan.name === 'Premium' || selectedPlan.name === 'Animado') {
                const radio = document.querySelector('input[name="image-pref"]:checked');
                if (radio) imagePref = radio.value;
            }

            // Objeto de Datos
            const formData = {
                customer: name,
                location: location,
                isSantaAna: isSantaAna,
                plan: selectedPlan.name,
                price: finalPrice,
                recipient: recipient,
                occasion: occasion,
                details: details,
                isRush: isRush,
                imagePref: imagePref,
                affiliate: affiliateCode || 'Directo',
                date: new Date().toISOString()
            };

            // Guardar en Firestore (Si est√° activo)
            if (db) {
                try {
                    const collection = db.collection('artifacts').doc(appId).collection('orders');
                    await collection.add(formData);
                } catch (error) { console.error("Offline o error config", error); }
            }

            // Generar Mensaje WhatsApp
            const line = "%0A";
            let text = `üëã Hola *Plaza Santa Ana*, me interesa una canci√≥n personalizada.${line}${line}`;
            
            text += `üìù *DATOS DEL PEDIDO*${line}`;
            text += `‚Ä¢ Cliente: ${name} (${location})${line}`;
            text += `‚Ä¢ Paquete: *${selectedPlan.name}* ($${finalPrice} USD)${line}`;
            if (isRush) text += `‚Ä¢ üöÄ *URGENTE* (Prioridad)${line}`;
            if (isSantaAna) text += `‚Ä¢ üìç *Soy de Santa Ana* (Pago al recibir)${line}`;
            
            text += `${line}üéµ *DETALLES DE LA CANCI√ìN*${line}`;
            text += `‚Ä¢ Para: ${recipient}${line}`;
            text += `‚Ä¢ Ocasi√≥n: ${occasion}${line}`;
            text += `‚Ä¢ Historia/Mensaje: ${details}${line}`;

            if (imagePref) {
                text += `${line}üì∏ *IMAGEN PARA VIDEO*${line}`;
                text += `‚Ä¢ Preferencia: ${imagePref}${line}`;
                if (imagePref === 'Enviar Foto') {
                    text += `_(Adjuntar√© la foto en este chat)_${line}`;
                }
            }
            
            if (affiliateCode) text += `${line}(Ref: ${affiliateCode})`;
            
            text += `${line}‚ú® *Espero confirmaci√≥n para realizar el pago/anticipo.*`;

            const waLink = `https://wa.me/${config.whatsappNumber}?text=${text}`;

            // Abrir WhatsApp
            window.open(waLink, '_blank');

            // UI √âxito
            closeModal();
            showSuccess(name);
            
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fab fa-whatsapp text-2xl"></i><span>Pedir por WhatsApp</span>';
        }

        function showSuccess(name) {
            const overlay = document.getElementById('success-overlay');
            document.getElementById('success-name').textContent = name;
            overlay.classList.remove('hidden');
            
            // Confetti Rosa y Cian
            const end = Date.now() + 2 * 1000;
            const colors = ['#E91E63', '#00BCD4', '#FFC107'];
            (function frame() {
                confetti({ particleCount: 4, angle: 60, spread: 55, origin: { x: 0 }, colors: colors });
                confetti({ particleCount: 4, angle: 120, spread: 55, origin: { x: 1 }, colors: colors });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }
    </script>
</body>
</html>
